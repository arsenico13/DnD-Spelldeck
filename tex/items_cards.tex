\documentclass{article}
\usepackage{ifxetex}
\usepackage{fancyhdr}
\usepackage{eso-pic}
\usepackage{xparse}
\usepackage{graphicx}
\usepackage{tikz}
\usepackage[paperheight=8.89cm,paperwidth=6.2cm,margin=0.4cm,top=21mm,bottom=10mm,headheight=1cm]{geometry}


% ===== Overlay PNG opzionale per singola card =====
\newcommand{\OverlayFile}{} % vuoto = nessun overlay
\newcommand{\OverlayOpacity}{1} % 0..1
\NewDocumentCommand{\OverlaySet}{m m}{\gdef\OverlayFile{#1}\gdef\OverlayOpacity{#2}}
\NewDocumentCommand{\OverlayClear}{}{\gdef\OverlayFile{}}

% ===== Disegno: prima sfondo, poi overlay (entrambi dietro al testo) =====
\AddToShipoutPictureBG{%
  % 1) Sfondo
  \AtPageLowerLeft{%
    \includegraphics[width=\paperwidth,height=\paperheight]{images/background}%
  }%
  % 2) Overlay opzionale
  \AtPageLowerLeft{%
    \ifx\OverlayFile\empty\else
      \raisebox{10mm}[0pt][0pt]{%
        \parbox[b][\dimexpr\paperheight-63mm\relax][c]{\paperwidth}{%
          \centering
          \tikz \node[opacity=\OverlayOpacity,inner sep=0] {\includegraphics[width=0.5\paperwidth]{\OverlayFile}};%
        }%
      }%
    \fi
  }%
}


\ifxetex
\usepackage{fontspec}
\setmainfont{MrsEavesRoman}
\fi

\definecolor{headercolor}{RGB}{188,1,138}
\definecolor{linecolor}{RGB}{201,173,106}

\sloppy
\setlength{\headsep}{3mm}
\pagestyle{fancy}
\chead{\scshape\scriptsize\spellheader\\[-1.8mm]\Large\color{headercolor}\mbox{\spelltitle}}
\cfoot{\if\relax\damagetype\relax\else\scriptsize\damagetype\fi}
\setlength{\parindent}{0pt}

\NewDocumentEnvironment{spell}{O{} O{1} m m m m m m m}{%
    % #1 = overlay opzionale (può essere vuoto)
    % #2 = opacità overlay (0..1), default 1
    \IfBlankTF{#1}{\OverlayClear}{\OverlaySet{#1}{#2}}%

    \def\spelltitle{#3}
    \def\spellheader{#4}
    \def\itemweight{#5}
    \def\itemcost{#6}
    \def\damage{#7}
    \def\attunement{#8}
    \def\damagetype{#9}

    \begin{minipage}[t][5cm][t]{\textwidth}
    \vspace{-3mm}
    \begin{minipage}[t]{0.49\textwidth}
        \centering\footnotesize\scshape{\color{headercolor}Costo}

        \itemcost
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.49\textwidth}
        \centering\footnotesize\scshape{\color{headercolor}Tipo danno}

        \itemweight
    \end{minipage}\\[3mm]
    \begin{minipage}[t]{0.49\textwidth}
        \centering\footnotesize\scshape{\color{headercolor}Sintonia}

        \attunement
    \end{minipage}
    \hfill
    \begin{minipage}[t]{0.49\textwidth}
        \centering\footnotesize\scshape{\color{headercolor}Danno}

        \damage
    \end{minipage}
    \vspace{3mm}
    \headrule
    \vspace{3mm}
    \footnotesize
}{%
    \end{minipage}
    \newpage
    \OverlayClear % evita carry-over, ma solo dopo lo shipout della pagina corrente
}


\begin{document}
\input{items}
\end{document}
